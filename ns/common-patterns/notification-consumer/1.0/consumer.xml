<description datatypeLibrary="http://www.w3.org/2001/XMLSchema-datatypes" xmlns="http://riddl.org/ns/description/1.0" xmlns:xi="http://www.w3.org/2001/XInclude">

  <message name="notification">
    <parameter name="key" type="string"/>
    <parameter name="topic" type="string"/>
    <parameter name="event" type="string"/>
    <parameter name="notification" mimetype="text/xml" handler="http://riddl.org/ns/handlers/relaxng">
      <grammar xmlns="http://relaxng.org/ns/structure/1.0" datatypeLibrary="http://www.w3.org/2001/XMLSchema-datatypes" ns="http://riddl.org/ns/common-patterns/notification-consumer/1.0">
        <start>
          <element name="notification">
            <zeroOrMore>
              <ref name="header"/>
            </zeroOrMore>  
            <zeroOrMore>
              <ref name="parameter"/>
            </zeroOrMore>  
          </element>
        </start>

        <define name="header">
          <element name="header">
            <attribute name="name">
              <data type="string"/>
            </attribute>
            <optional>
              <attribute name="type">
                <data type="string"/>
              </attribute>  
            </optional>  
            <data type="string"/>
          </element>
        </define>  
        
        <define name="parameter">
          <element name="parameter">
            <attribute name="name">
              <data type="string"/>
            </attribute>
            <optional>
              <choice>
                <attribute name="type">
                  <data type="string"/>
                </attribute>  
                <attribute name="mimetype">
                  <data type="string">
                    <param name="pattern">[\c]+/[\c\+]+|\*</param>
                  </data>  
                </attribute>  
              </choice>  
            </optional>
            <ref name="any"/>
          </element>
        </define>  

        <define name="any">
            <mixed>
          <zeroOrMore>
              <element>
                <anyName/>
                <zeroOrMore>
                  <choice>
                    <attribute>
                      <anyName/>
                    </attribute>
                    <text/>
                    <ref name="any"/>
                  </choice>
                </zeroOrMore>
              </element>
          </zeroOrMore>  
            </mixed>  
        </define>

      </grammar>
    </parameter>
    <optional>
      <parameter name="consumer-id" type="string"/>
      <parameter name="fingerprint-with-consumer-secret" type="string"/>
    </optional>  
  </message>

  <message name="acknowledgment">
    <optional>
      <parameter name="producer-id" type="integer"/>
      <parameter name="fingerprint-with-producer-secret" type="string"/>
    </optional>  
  </message>

  <resource pattern="http://riddl.org/ns/common-patterns/notification-consumer/1.0">
    <post in="notification" out="acknowledgment"/>
  </resource>  

</description>
