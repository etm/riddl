<description datatypeLibrary="http://www.w3.org/2001/XMLSchema-datatypes" xmlns="http://riddl.org/ns/description/1.0" xmlns:xi="http://www.w3.org/2001/XInclude">

  <message name="topics">
    <parameter name="topics" mimetype="text/xml" handler="http://riddl.org/ns/handlers/relaxng">
      <grammar xmlns="http://relaxng.org/ns/structure/1.0" datatypeLibrary="http://www.w3.org/2001/XMLSchema-datatypes" ns="http://riddl.org/ns/common-patterns/notification-producer/1.0">
        <start>
          <element name="topics">
            <zeroOrMore>
              <ref name="topic"/>
            </zeroOrMore>  
          </element>
        </start>

        <define name="topic">
          <element name="topic">
            <data type="string"/>
          </element>
        </define>  

      </grammar>
    </parameter>
  </message>
  
  <message name="subscriptions">
    <parameter name="subscriptions" mimetype="text/xml" handler="http://riddl.org/ns/handlers/relaxng">
      <grammar xmlns="http://relaxng.org/ns/structure/1.0" datatypeLibrary="http://www.w3.org/2001/XMLSchema-datatypes" ns="http://riddl.org/ns/common-patterns/notification-producer/1.0">
        <start>
          <element name="subscriptions">
            <attribute name="information">
              <choice>
                <value>full (insecure)</value>
                <value>details (verbose client)</value>
                <value>scarce (verbose server)</value>
                <value>production</value>
              </choice>  
            </attribute>
            <zeroOrMore>
              <ref name="subscription"/>
            </zeroOrMore>  
          </element>
        </start>

        <define name="subscription">
          <element name="subscription">
            <attribute name="id">
              <data type="string"/>
            </attribute>
            <attribute name="url">
              <data type="string"/>
            </attribute>
            <attribute name="secret">
              <data type="string"/>
            </attribute>
            <zeroOrMore>
              <element name="topic">
                <data type="string"/>
              </element>
            </zeroOrMore>
          </element>
        </define>

      </grammar>
    </parameter>
  </message>
  
  <message name="subscription">
    <parameter name="subscription" mimetype="text/xml" handler="http://riddl.org/ns/handlers/relaxng">
      <grammar xmlns="http://relaxng.org/ns/structure/1.0" datatypeLibrary="http://www.w3.org/2001/XMLSchema-datatypes" ns="http://riddl.org/ns/common-patterns/notification-producer/1.0">
        <start>
          <element name="subscription">
            <attribute name="information">
              <choice>
                <value>full (insecure)</value>
                <value>production</value>
              </choice>  
            </attribute>
            <ref name="subscription"/>
          </element>
        </start>

        <define name="subscription">
          <element name="subscription">
            <attribute name="url">
              <data type="string"/>
            </attribute>
            <attribute name="secret">
              <data type="string"/>
            </attribute>
            <oneOrMore>
              <element name="topic">
                <data type="string"/>
              </element>
            </oneOrMore>
          </element>
        </define>

      </grammar>
    </parameter>
  </message>

  <message name="subscribe">
    <parameter name="url" type="string"/>
    <oneOrMore>
      <parameter name="topic" type="string"/>
    </oneOrMore>
    <parameter name="public-key" type="string"/>
  </message>  
  <message name="details">
    <parameter name="url" type="string"/>
    <oneOrMore>
      <parameter name="topic" type="string"/>
    </oneOrMore>
  </message>  
  <message name="acknowledgment">
    <parameter name="key" type="string"/>
    <parameter name="secret" type="string"/>
  </message>

  <resource pattern="http://riddl.org/ns/common-patterns/notification-producer/1.0">
    <resource relative="notifications">
      <resource relative="topics">
        <get in="*" out="topics"/>
      </resource>
      <resource relative="subscriptions">
        <get in="*" out="subscriptions"/>
        <post in="subscribe" out="acknowledgment"/>
        <resource>
          <get in="*" out="subscription"/>
          <put in="details"/>
          <delete in="*"/>
        </resource>
      </resource>
    </resource>
  </resource>  

</description>
