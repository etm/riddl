<description datatypeLibrary="http://www.w3.org/2001/XMLSchema-datatypes" 
             xmlns="http://riddl.org/ns/description/1.0" 
             xmlns:ann="http://riddl.org/ns/annotation/1.0" 
             xmlns:xi="http://www.w3.org/2001/XInclude">

<!-- Messages -->
<!--{{{-->
  <message name="description">
    <parameter name="description" mimetype="text/xml" handler="http://riddl.org/ns/handlers/relaxng">
      <xi:include href="../../ns/description/1.0/description.rng"/>
    </parameter>
  </message>

  <message name="xml">
    <parameter name="xml" mimetype="text/xml"/>
  </message>

  <message name="class-level-workflow">
    <parameter name="class-level-workflow" mimetype="text/xml"/>
  </message>
  
    <message name="instance-level-workflow">
    <parameter name="instance-level-workflow" mimetype="text/xml"/>
  </message>
  <message name="atom-feed">
    <parameter name="feed" mimetype="application/atom+xml"/>
  </message>

  <message name="input">
    <parameter name="input" type="string"/>
  </message>
  <message name="output">
    <parameter name="output" type="string"/>
  </message>
  <message name="properties">
    <parameter name="properties" type="string"/>
  </message>
  <message name="service-schema">
    <parameter name="service-schema" type="string"/>
  </message>

  <message name="schema">
    <parameter name="schema" mimetype="text/xml" handler="http://riddl.org/ns/handlers/relaxng"/>
  </message>

  <message name="group">
    <parameter name="group-name" type="string"/>
    <parameter name="domain-description" mimetype="text/xml" handler="http://riddl.org/ns/handlers/relaxng">
      <xi:include href="rng+xsl/domain.rng"/>
    </parameter>
  </message>

  <message name="rename">
    <parameter name="new-name" type="string"/>
  </message>

  <message name="subclass">
    <parameter name="subclass-name" type="string"/>
  </message>

  <message name="riddl-description">
    <parameter name="riddl-description" type="string"/>
  </message>


  <message name="service">
    <parameter name="service-name" type="string"/>
    <parameter name="service-description" mimetype="text/xml"/>
  </message>

  <message name="service-description">
    <parameter name="service-description" mimetype="text/xml"/>
  </message>

  <message name="injection-handler-request">
    <parameter name="notification-key" type="string"/>
  </message>

  <message name="injection-instance-queue-request">
    <parameter name="instance" type="string"/>
  </message>

  <message name="injection-service-request">
    <parameter name="position" type="string"/>
    <parameter name="instance" type="string"/>
    <parameter name="handler" type="string"/>
    <parameter name="description" mimetype="text/xml"/>
  </message>

  <message name="injection-service-response">
    <parameter name="position" type="string"/>
    <parameter name="state" type="string"/>
  </message>

  <message name="change-position">
    <parameter name="instance" type="string"/>
    <parameter name="new-position" type="string"/>
  </message>
<!--}}}-->  
<!-- Resources -->
<!-- {{{ -->
  <resource>
    <request method="get" in="riddl-description" out="description">
      <ann:label xml:lang="en">Show description</ann:label>
    </request>
    <resource relative="xsl" recursive="true">
      <get in="*" out="xml"/>
    </resource>  
    <resource relative="injection">
      <resource relative="handler">
        <post in="injection-handler-request"/>
        <get in="*"/>
        <get in="injection-instance-queue-request"/>
        <post in="*"/><!-- this is for the cpee-notification --> 
        <put in="change-position"/>
      </resource>
      <resource relative="service">
        <post in="injection-service-request" out="injection-service-response"/>
      </resource>
    </resource>
    <resource relative="select">
      <resource relative="random">
        <post in="*"/>
      </resource>
      <resource relative="pgwl">
        <get in="*"/>
        <post in="*"/>
      </resource>
    </resource>
    <resource relative="groups">
<!-- {{{ -->
      <get in="*" out="atom-feed"/>
      <post in="group"/>
<!--}}}-->
      <resource> <!-- Group-level -->
<!-- {{{ -->
        <get in="*" out="atom-feed"/>
        <get in="properties" out="schema"/>
        <get in="service-schema" out="schema"/>
        <put in="rename"/>
        <post in="subclass"/>
        <delete in="*"/>
        <resource relative="operations">
          <get in="*" out="xml"/>
          <resource>
            <get in="*" out="class-level-workflow"/>
            <get in="input" out="schema"/>
            <get in="output" out="schema"/>
            <resource relative="templates">
              <resource>
                <get in="*"/>
              </resource>
            </resource>
          </resource>
        </resource>
<!--}}}-->
        <resource> <!-- subclass-level -->
<!-- {{{ -->
          <get in="*" out="atom-feed"/>
          <delete in="*"/>
          <put in="rename"/>
          <post in="service"/>
          <resource relative="operations">
            <get in="*" out="xml"/>
            <resource>
              <get in="*" out="class-level-workflow"/>
              <get in="input" out="schema"/>
              <get in="output" out="schema"/>
            </resource>
          </resource>
<!--}}}-->
          <resource> <!-- Service-level -->
<!-- {{{ -->
            <get in="*" out="instance-level-workflow"/>
            <put in="rename"/>
            <put in="service-description"/>
            <delete in="*"/>
            <resource relative="operations">
              <get in="*" out="xml"/>
              <resource>
                <get in="*" out="class-level-workflow"/>
                <get in="input" out="schema"/>
                <get in="output" out="schema"/>
                <resource relative="templates">
                  <resource>
                    <get in="*"/>
                  </resource>
                </resource>
              </resource>
            </resource>
<!--}}}--> 
          </resource>  

        </resource>  
      </resource>  
    </resource>  
  </resource>  
<!-- }}} -->
</description>
