<?xml version="1.0"?>

<service-description xmlns="http://rescue.org/ns/service/0.2"
                 xmlns:flow="http://rescue.org/ns/controlflow/0.2"
                 xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <properties>
    <city>Vienna</city>
    <street>Rathausstrasse</street>
    <carpark>true</carpark>
  </properties>
  <operations>
    <search>
      <execute>
        <flow:endpoint id="search">super-kino.at/web-api</flow:endpoint>

        <flow:context id="operation">suchen</flow:context>
        <flow:context id="saal">keine Angabe</flow:context>

        <flow:call id="search" endpoint="search" http-method="get" http-status="200">
          <flow:input name="op" context="operation"/>
          <flow:input name="titel" message-parameter="title"/>
          <flow:input name="datum" message-parameter="date"/>
          <flow:input name="zeit" message-parameter="preferred-time"/>
          <flow:output name="list" message-parameter="list-of-shows"/>
        </flow:call>
      </execute>
      <compensate/>
      <undo/>
      <redo/>
      <suspend/>
      <abort/>
    </search>
    <book>
      <execute>
        <flow:endpoint id="anmelden">super-kino.at/login</flow:endpoint>
        <flow:endpoint id="buchen">super-kino.at/web-api</flow:endpoint>

        <flow:context id="operation">buchen</flow:context>
        <flow:context id="sitzungsID"/>

        <flow:call id="login" endpoint="anmelden" http-method="get" http-status="200">
          <flow:input name="name" message-parameter="username"/>
          <flow:input name="pwd" message-parameter="password"/>
          <flow:output name="id" context="sitzungsID"/>
        </flow:call>

        <flow:call id="buchen" endpoint="buchen" http-method="post"  http-status="201">
          <flow:input name="op" context="operation"/>
          <flow:input name="vorstellung" message-parameter="show-id"/>
          <flow:input name="anzahl" message-parameter="number-of-seats"/>
          <flow:input name="id" context="sitzungsID"/>
          <flow:output name="out" message-parameter="reservation_id">
            <xsl:template match="/">
              <xsl:apply-templates select="//res-id"/>
            </xsl:template>
            <xsl:template match="//res-id">
              <xsl:value-of select="text()"/>
            </xsl:template>
          </flow:output>
        </flow:call>
      </execute>
      <compensate/>
      <undo/>
      <redo/>
      <suspend/>
      <abort/>
    </book>
    <popcorn>
      <execute>
        <flow:endpoint id="popcorn">super-kino.at/popcorn-bestellen</flow:endpoint>
        <flow:context id="operation">bestellen</flow:context>
        <flow:call id="search" endpoint="search" http-method="get" http-status="200">
          <flow:input name="op" context="operation"/>
          <flow:input name="res-nr" message-parameter="reservation_id"/>
          <flow:input name="menge" message-parameter="quantity"/>
          <flow:output name="out" message-parameter="order_number">
            <xsl:template match="/">
              <xsl:apply-templates select="//menge"/>
            </xsl:template>
            <xsl:template match="//menge">
              <xsl:value-of select="text()"/>
            </xsl:template>
          </flow:output>
          <flow:output name="out" message-parameter="price">
            <xsl:template match="/">
              <xsl:apply-templates select="//preis"/>
            </xsl:template>
            <xsl:template match="//preis">
              <xsl:value-of select="text()"/>
            </xsl:template>
          </flow:output>
        </flow:call>
      </execute>
      <compensate/>
      <undo>
        <flow:endpoint id="search">super-kino.at/popcorn-bestellen</flow:endpoint>

        <flow:context id="operation">abbestellen</flow:context>
        <flow:context id="saal">keine Angabe</flow:context>

        <flow:call id="search" endpoint="search" http-method="get" http-status="200">
          <flow:input name="op" context="operation"/>
          <flow:input name="b_nummer" message-parameter="order_number"/>
        </flow:call>
      </undo>
      <redo/>
      <suspend/>
      <abort/>
    </popcorn>
  </operations>
</service-description>
