<?xml version="1.0"?>
<controlflow xmlns="http://rescue.org/ns/controlflow/0.2">
  <endpoint id="epApproval">http://company.org/approval</endpoint>

  <context id="persons">3</context>
  <context id="creditcard">Visa-902384234890</context>
  <context id="from">Vienna</context>
  <context id="to">Dublin</context>
  <context id="sum"/>

  <context id="approved">false</context>

  <cycle id="cycle_persons">
    <condition test="persons" comparator="&gt;" fix-value="0"/>
    <iterated-context id="hotel"/>
    <iterated-context id="airline"/>
    <parallel type="wait">
      <branch>
        <endpoint id="epAirBook">http://air.org/book</endpoint>
        <endpoint id="epAirPay">http://air.org/pay</endpoint>
        <critical id="airbooking">
          <call id="a1_1" endpoint="epAirBook" http-method="post" http-status="201">
            <input name="from" context="from"/>
            <input name="to" context="to"/>
            <output name="id" context="airline"/>
          </call>
          <call id="a1_2" endpoint="epAirPay" http-method="post" http-status="200">
            <input name="airline" context="airline"/>
            <input name="creditcard" context="creditcard"/>
            <output target="sum" operator="+=" name="amount"/>
          </call>
        </critical>
      </branch>
      <branch>
        <endpoint id="epHotelBook">http://hotel.org/book</endpoint>
        <endpoint id="epHotelBook">http://hotel.org/pay</endpoint>
        <critical id="hotelbooking">
          <call id="a2_1" endpoint="epHotelBook" http-method="post" http-status="201">
            <input name="to" context="to"/>
            <output name="id" context="hotel"/>
          </call>
          <call id="a1_2" endpoint="epHotelPay" http-method="post" http-status="200">
            <input name="hotel" context="hotel"/>
            <input name="creditcard" context="creditcard"/>
            <output target="sum" operator="+=" name="amount"/>
          </call>
        </critical>
      </branch>
    </parallel>
    <manipulate id="reduce_persons" target="persons" operator="-=" fix-value="1"/>
  </cycle>
  <choose>
    <alternative>
      <group connector="and">
        <condition test="airline" comparator="!=" fix-value="crash-for-sure"/>
        <condition test="sum" comparator="&lt;" fix-value="1000"/>
        <group connector="or">
          <condition test="airline" comparator="==" fix-value="aeroflot"/>
          <condition test="airline" comparator="==" fix-value="rayenair"/>
        </group>
      </group>
        <call id="a3" endpoint="approval" http-method="get" http-status="200">
          <input name="sum" context="sum"/>
          <output name="approved" context="approved"/>
        </call>
    </alternative>
  </choose>
</controlflow>
